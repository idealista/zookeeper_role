language: python
python: 2.7.15
sudo: required
services:
- docker
install:
- pip install pipenv
- pipenv install -r test-requirements.txt --python 2.7

env:
  global:
  - secure: XlU2gbVAKXxeBq0ytMd9ayYAeh9aOjKmanDnX5TrsBzOxFpLH5fBZIbfo40eYyyIWt3kkZ4RzuDBSq7t2AJYWCnsYc/7qCDL1X0wwlKsdiehxoX7XO7DcnAW+OKD93nHkshjt0LyjqdRfsvfoe7TKn9h8cSbxP4rDV+bfHKnng4FzZFppjmJeilbUHwj3MjB4aENeP5qqB7hmhnAImh2xlUT0f9NjmingYgaeP1s+MYuJDzwIUUHfwqwVnR7TA4/UtuE+XTtGyYQ4Tu/u5X7gRw9iT3f3f0+vlvmOzD+EpqGZELl9vGlpkTnD9g4TkaDbaCUb/qIbhZKRspPBdIQxq1mmgz8P5XAnOLH4CNAyNgQWJkrKqB1CYpUBKvDEWUJGHAIFoiyENTwMDMpg+75HCBAcz3RzDcEuzfUKZj2cyU9/ed+WwftjFJUklu8O9yjwEOsO4IeontPiMUa++Pf4FnJqPtUgWv5fja8Alqjdzgv/X4l0w59gXN+dTPbKIigVSi6t7oZQyH4WquHr+NTVhc/JuvzVlQ9Gr+t/0YGDX1x+jYErs/mTdNvacYzh+bCP8sN6YgKK7FgJ8gCrzmlO5CelZ5NBmWVkxlx8v8QFN0qDiqxsg8Wjd1RhyflZ4YFSo0DOhoxaodOn9CvmMQuIA1zft5Bz4DpeNFazAiQ5zU=
  - secure: QAR4xX2pqzgJkSNye8XmYjcgDzS2UJfEq9jxdSl5Eav5lJy5aqqF8fycv6s6CeXvIqoRV7z9s06io6IWZ096XrKPncDnv8syzAKFSxFLiSiH7bUqvrJY8B/UqYmEkO4t/4AhsB58Fbhi2v3dc+a3NbtAiIBqU+hcD72MuwvykuyG7q/74+/MOVZor5bk2U/FtJZRoGMVIYRdjzeui4N8e6AeyJuCCJ0bJ+/FoS9m1X7dcpM+otrY7MrqQOs0e/7B+mE8ez6+NhcuUh3S21vZkGMfxKLRJoYH07WRheXpw8qAINQeeo0TE2I12H3I/Oyb8fEatc5cEyZ1dLNn4X5LCl+tEAWBWY/BKmHiko98YE9bOP2Jw4y6ArPc/ZhuYqMTiUgtGZZ1uz9MSaKzRncoMB6+eO29oOFwNLgVFnzvgC1ZhWUnQQUvOOD4EfhsEqUJ67sMuGjNHB2os2ppanc7myJE/xlTZxKQXE4OE8HJ0HxdEEVyZl13M0aos00MQTMgFaaxmX1GIPEV5oFW8/E3yZoKUcC2Urihn/RM/2aVhsIcqXPeQ7m8l/jODfcP4U04IaoMgNMPmUFlk4Ly2W+ugSXk6xSlu39VQeTRJznFuRKVyU1QlNdiIGvbKsLalMj5LyxlMOVGpqRwtngHmT80+puu01Cu4KnuJmujV0PSp9k=
  - secure: j7g0vouk54s0Z1fGwuF6iTk0ZwIzdLGB5isT4dtYYpyI+N+jdu1OrXX/gazZujsw7eNl5dICj0n0mbfPV6lrxegJfB4xdm6uvF0fODj5dbg8kdywsI8lxpd7nbAyWAUClAXw8ij+5ItIlIkHezge846olneU8JI31RxijDo1SvMdkd1PWlrbW0EBv7iAAA2Ex7HIM9MxBYFZKpxwFFcjawiJFyNLunuhPGsyHdMc51uLfq/eIR0hRaZxTqyR2nd9r9dG/4xlaxAuVycD4tOyp4poIri+vkOS5Ff3dtUCv2KWIbiNAG8fcEXjwkmHJrwYTwv9eEtmLZwWgTAVFOMV2DEsR+y6EeZU3g8UT8TZc6pbylvhyihgLWp6UfVJjyqzYFXYhu5JO+QOUIrv/I3BnKWmEt8xnwIXhydNQJPnhnGDsde+UoUk5ZMUhBimOAxic2AonIhMHJk6w2nWzZIwHeBjsIAfsf89zy37TIgL2KrqTztOHZ8B6OgB9TdF756R2zBa8wsUdxav3XluxMLy74jTzHQdZWKljVLyeSMdjwO6hm7LVWvYp49e8IWhMcWO5rdTrhsYkXClTRZdI8BitoHGAiN/0eEIH2uO7lmXQrl1SqYtMbtYrO/7z+Jldt61bLvmn9mVoweK0YQYZMxSaY8LCnOBNiksIryGrNeJ2Zk=

script:
- pipenv run molecule test
notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
deploy:
  provider: script
  script:
  - ANSIBLE_ROLES_PATH=../ pipenv run ansible-playbook dockerhub/deploy.yml --extra-vars "docker_hub_email=${DOCKER_EMAIL} docker_hub_username=${DOCKER_USERNAME} docker_hub_password=${DOCKER_PASSWORD}"
  on:
    branch: master
    tags: true